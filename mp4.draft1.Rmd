---
title: " The Class Clown, the Drama Queen and the Nerd: How Movie Genres are mirroring our favorite High School Stereotypes "
author: "Anna Ballou, Nicole Lawler, Jessica Jacinto"
date: "59/2019"
output: 
  html_document:
    theme: journal
    fig_width: 6
    fig_height: 4
    fig_caption: true
    df_print: paged
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rmarkdown::paged_table
```


*“I wish there was a way to know you're in the good old days before you've actually left them.” ― Andy Bernard (The Office)*

```{r, message = FALSE}
library(tidyverse)
library(RMySQL)
library(ggplot2)
library(rmarkdown)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "imdb")
knitr::opts_chunk$set(connection = db, max.print = 400)
```

```{r, message = FALSE, warning = FALSE}
db <- dbConnect(MySQL(),
                host = "scidb.smith.edu",
                user = "mth292",
                password = "RememberPi",
                dbname = "imdb")
```

**Section 1: Examining America’s Favorite Genres** 

While most Americans claim that their high school days are far behind them, recent movie data (source: IMDb) begs to differ. Beginning around 1990, American preferences for certain movie genres have risen exponentially. Currently, Americans preferences have spiked for Comedies, Dramas and Documentaries. More specifically, in 1920, only 6,281 Dramas, 3,099 Documentaries and 9,301 Crime films were produced. Flash forward to the turn of the of the century and movie screens nationwide featured 72,109 Dramas, 67,263 Documentaries and 53,557 Comedies. These numbers can all be seen in table 1 of this article. 


**Table 1. Number of Films Produced in each Genre for each decade.**                 
```{r, message = FALSE, warning = FALSE}
sql1 <- "
SELECT 
	FLOOR(t.production_year/10) *  10 AS decade,
	mi.info AS genre, 
	COUNT(DISTINCT mi.id) AS number_of_films
    
FROM movie_info AS mi
INNER JOIN title AS t ON t.id = mi.movie_id
WHERE mi.info_type_id = 3
AND t.production_year >= 1920
AND t.production_year < 2010
AND mi.info <> 'Short'
AND mi.info <> 'Erotica'
AND mi.info <> 'Experimental'
AND mi.info <> 'Lifestyle'
AND mi.info <> 'Sport'
AND mi.info <> 'Talk-Show'
AND mi.info <> 'News'
GROUP BY floor(t.production_year/10) *  10, mi.info
ORDER BY 1,2
;"

db1 <- db %>%
  dbGetQuery(sql1)

paged_table(db1)
```

```{r, message = FALSE, warning = FALSE}
plot1 <- ggplot(data = db1, aes(x = decade, y = number_of_films)) +
  geom_line() +
  facet_wrap(~genre) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ggtitle("Film Genre Preferences through the Ages", subtitle = "Source: IMDb")
print(plot1)
```

*This graphic shows the changes in number of films produced for each decade. Each miniature graph within the graphic represents a different genre.*

It is almost interesting to note that the large difference between number of films per decade produced was not linear. We would assume that as film technology increases, the number of films produced would also increase proportionally. The graph below, however, shows that these genres (Dramas, Documentaries and Comedies) saw a large, disproportionate spike beginning in the 1990s. 
Andy Bernard, a fictional character from the American fan favorite comedy show, The Office, remarks “I wish there was a way to know you’re in the good old days before you’ve actually them them.” [^1]  With the United State’s aging population, this nostalgic sentiment is not unique to Andy. Many Americans now fondly refer to their “glory days” of high school. Interestingly, their movie preferences reflect this wistful remembrance, as Americans have called for more films that play into their “old-school” high school stereotypes. 


**Our Cast of Characters:**

*The Nerd*, as played by the Documentary Genre

*The Class Clown*, as played by the Comedy Genre

*The Drama Queen*, as played by the Drama Genre 


**Table 2. Gross Income per Each Genre for Each Decade**
```{r, message = FALSE, warning = FALSE}
sql2 <- "
SELECT 
	FLOOR(t.production_year/10) *  10 AS decade,
	COALESCE(mi.info,'Other') AS genre, 
    SUM(CONVERT(
			TRIM(
				REPLACE(
					REPLACE(
						SUBSTRING_INDEX(mi2.info,'(USA)',1) -- split on 'USA'
						 ,'$','') -- close replace dollar sign with space
                           , ',', '') -- close replace comma with space 
                           ) -- close trim
                           , signed) -- close convert
						) AS gross_income -- close sum
FROM title AS t
INNER JOIN movie_info AS mi ON t.id = mi.movie_id
INNER JOIN movie_info AS mi2 ON mi.movie_id = mi2.movie_id
WHERE mi.info_type_id = 3
AND mi2.info_type_id = 107
AND SUBSTRING(mi2.info,1,1) = '$'
AND mi2.info LIKE '%(USA)%'
AND t.production_year >= 1920
AND t.production_year <= 2010
AND mi.info <> 'Reality-TV'
AND mi.info <> 'News'
AND mi.info <> 'Talk-Show'
GROUP BY FLOOR(t.production_year/10) *  10, mi.info
ORDER BY 1,2
;"

db2 <- db %>%
  dbGetQuery(sql2)

paged_table(db2)
```

```{r, message = FALSE, warning = FALSE}
plot2 <- ggplot(data = db2, aes(x = decade, y = gross_income)) +
  geom_line() +
  facet_wrap(~genre) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_y_continuous(labels = c("0", "200 Billion", "400 Billion", "600 Billion")) +
  ggtitle("Gross Spending on Film Genres", subtitle = "Curreny: $, Source: IMDb")
print(plot2)
```

*This graphic shows the total gross income (funds attributed to films) for each decade. The income is in U.S. dollars. Each miniature graph within the graphic represents a different genre.*

**Citations and git Hub Repository**

Github: https://github.com/aballou16/mp4.git

[^1]: https://www.imdb.com/title/tt0386676/